<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
 <title>Customer</title>
 <!-- Base formatting. -->
 <link href="Default.css" rel="stylesheet" />
 <!-- Common Kendo UI CSS for web widgets and widgets for data visualization. -->
 <link href="styles/kendo.common.min.css" rel="stylesheet" />
 <!-- The following doesn't set a theme. -->
 <!-- Default Kendo UI theme CSS for web widgets and widgets for data visualization. -->
 <!-- <link href="styles/kendo.default.min.css" rel="stylesheet" /> -->
 <!-- Set a theme -->
 <link href="styles/kendo.blueopal.min.css" rel="stylesheet" />
 <!-- jQuery Javascript from VS2013 -->
 <script src="Scripts/jquery-1.10.2.min.js"></script>
 <!-- Kendo UI Combined. -->
 <script src="js/kendo.all.min.js"></script>
 <style type="text/css">
  .rdonly { background-color: #f0f0f0 !important; }
 </style>
</head>
<body>
 <div id="frmCustomer">
  <div class="demo-section k-content">
   <ul class="fieldlist">
    <li>
     <label for="customerTicket">Ticket:</label>
     <input id="customerTicket" type="text" class="k-textbox" style="width:100%" data-bind="value: packageSource.data()[0].CustomerTicket" />
     <label for="customerName">Name:</label>
     <input id="customerName" type="text" class="k-textbox" style="width:100%" data-bind="value: packageSource.data()[0].Name, events:{change:textChanged}" />
     <label for="customerAddress">Address:</label>
     <input id="customerAddress" type="text" class="k-textbox" style="width:100%" data-bind="value: packageSource.data()[0].Address, events:{change:textChanged}" />
     <label for="customerCity">City:</label>
     <input id="customerCity" type="text" class="k-textbox" style="width:100%" data-bind="value: packageSource.data()[0].City, events:{change:textChanged}" />
     <label for="customerState">State:</label>
     <input id="customerState" type="text" class="k-textbox" style="width:100%" data-bind="value: packageSource.data()[0].State, events:{change:textChanged}" />
     <label for="customerZipCode">Zip Code:</label>
     <input id="customerZipCode" type="text" class="k-textbox" style="width:100%" data-bind="value: packageSource.data()[0].ZipCode, events:{change:textChanged}" />
     <button data-role="button" data-icon="edit" data-bind="visible:isSaveVisible, enabled:isSaveEnabled, events:{click:saveClicked}" style="width:180px">Save</button>
    </li>
   </ul>
  </div>
  <div class="console"></div>
 </div>
<script>
 var customerID = 0;
 function getQueryVariable(variable)
 {
  var rv = "";  // Return value.
  var query = window.location.search.substring(1);
  var vars = query.split("&");
  for(var i = 0; i < vars.length; i++)
  {
   var pair = vars[i].split("=");
   if(pair[0] == variable) { rv = pair[1]; }
  }
  return rv;
 }
 function setReadOnly(name)
 {
  $(name).attr("readonly", true);
  $(name).addClass("rdonly");
  $(name).attr("tabindex", -1);
 }
 $(document).ready(function()
 {
  try
  {

   var e;
   customerID = getQueryVariable("id");

   var customerModel = new kendo.data.Model.define({
    id: "CustomerID",
    fields: {
     CustomerID: {},
     CustomerTicket: {},
     Name: {},
     Address: {},
     City: {},
     State: {},
     ZipCode: {},
     TIN: {}
    }
   });

   var customerData = new kendo.data.DataSource({
    schema: customerModel,
    transport: {
     read: {
      url: "api/Customers/" + customerID.toString(),
      dataType: "json"
     },
     update: {
      // Notice that an update won't occur on this DataSource if a model with
      // an id: hasn't been defined. In this case, id: "CustomerID" is defined
      // in the model.
      url: "api/Customers/" + customerID.toString(),
      dataType: "json",
      type: "POST"
     },
     destroy: {
      url: "api/Customers/" + customerID.toString(),
      dataType: "json",
      type: "DELETE"
     },
     parameterMap: function(options, operation)
     {
      //if(operation === "update")
      //{
      // // During an update, any dates need to be formatted in a way they can
      // // be consumed by WebAPI.
      // var d = new Date(options.DateOpened);
      // options.DateOpened = kendo.toString(d, "MM/dd/yyyy");
      //}
      return options;
     }
    }
   });

    var viewModel = kendo.observable({
     packageSource: customerData,
     isSaveVisible: true,
     isSaveEnabled: false,
     textChanged: function(e)
     {
      this.set("isSaveEnabled", true);
      console.log("Text changed Event: " + e.type);
     },
     saveClicked: function(e)
     {
      console.log("Has changes: " + this.packageSource.hasChanges());
      console.log("Save clicked Event.");
      this.packageSource.sync();
      this.set("isSaveEnabled", false);
     }
    });

    kendo.bind($("#frmCustomer"), viewModel);
    setReadOnly("#customerTicket");

    if(parseInt(customerID) > 0)
    {
     customerData.read();
     console.log("Has changes: " + viewModel.packageSource.hasChanges());
    }
    else
    {
     alert("Customer not specified...");
    }

  }
  catch(ex)
  {
   alert(ex.message);
  }
 });
</script>

</body>
</html>
