<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
 <title>BankCore featuring Kendo UI MVVM JQuery, ASP.NET and REST</title>
 <!-- Base formatting. -->
 <link href="Default.css" rel="stylesheet" />
 <!-- Common Kendo UI CSS for web widgets and widgets for data visualization. -->
 <link href="styles/kendo.common.min.css" rel="stylesheet" />
 <!-- The following doesn't set a theme. -->
 <!-- Default Kendo UI theme CSS for web widgets and widgets for data visualization. -->
 <!-- <link href="styles/kendo.default.min.css" rel="stylesheet" /> -->
 <!-- Set a theme -->
 <link href="styles/kendo.blueopal.min.css" rel="stylesheet" />
 <!-- jQuery Javascript from VS2013 -->
 <script src="Scripts/jquery-1.10.2.min.js"></script>
 <!-- Kendo UI Combined. -->
 <script src="js/kendo.all.min.js"></script>
</head>
<body>
 <div id="pnlMain">
  <div id="tctlMain">
   <div class="demo-section k-content">
    <div id="tabstrip">
     <ul>
      <li class="k-state-active">Customers</li>
      <li>Accounts</li>
      <li>Branches</li>
      <li>Employees</li>
     </ul>
     <div>
      <!-- Customers -->
      <span class="tpanel">Select a customer to edit or view.</span>
      <div class="tcontent">
       <div id="dgCustomers"></div>
      </div>
     </div>
     <div>
      <!-- Accounts -->
      <span class="tpanel">&nbsp;</span>
      <div class="tcontent">
       <h2>&nbsp;</h2>
      </div>
     </div>
     <div>
      <!-- Branches -->
      <span class="tpanel">&nbsp;</span>
      <div class="tcontent">
       <h2>&nbsp;</h2>
      </div>
     </div>
     <div>
      <!-- Employees -->
      <span class="tpanel">&nbsp;</span>
      <div class="tcontent">
       <h2>&nbsp;</h2>
      </div>
     </div>
    </div>
   </div>
  </div>
 </div>
 <div id="pnlCustomer" class="hidden">
  <div class="backButton"><a onclick="activateMain();"><img src="Images/BackArrow.png" /> Back to main form</a></div>
  <div class="formBody" style="width:400px">
   <h2>Customer</h2>
   <div id="frmCustomer">
    <div class="demo-section k-content">
     <table class="formFields">
      <tr><td>Ticket:</td>
      <td><input id="customerTicket" type="text" class="k-textbox" 
       data-bind="value: packageSource.data()[0].CustomerTicket" /></td></tr>
      <tr><td>Name:</td>
      <td><input id="customerName" type="text" class="k-textbox" 
       data-bind="source: packageSource, value: packageSource.customerName, events:{change:textChanged}" /></td></tr>
      <tr><td>Address:</td>
      <td><input id="customerAddress" type="text" class="k-textbox"
       data-bind="value: packageSource.data()[0].Address, events:{change:textChanged}" /></td></tr>
      <tr><td>City:</td>
      <td><input id="customerCity" type="text" class="k-textbox"
       data-bind="value: packageSource.data()[0].City, events:{change:textChanged}" /></td></tr>
      <tr><td>State:</td>
      <td><input id="customerState" type="text" class="k-textbox"
       data-bind="value: packageSource.data()[0].State, events:{change:textChanged}" /></td></tr>
      <tr><td>Zip Code:</td>
      <td><input id="customerZipCode" type="text" class="k-textbox"
       data-bind="value: packageSource.data()[0].ZipCode, events:{change:textChanged}" /></td></tr>
      <tr><td>&nbsp;</td><td><button data-role="button" data-icon="edit"
       data-bind="visible:isSaveVisible, enabled:isSaveEnabled, events:{click:saveClicked}"
       style="width:180px">Save</button></td></tr>
     </table>
    </div>
   </div>
  </div>
 </div>
 <div id="pnlAccount" class="hidden">

 </div>
 <div id="pnlBranch" class="hidden">

 </div>
 <div id="pnlEmployee" class="hidden">

 </div>
 <script>
  function activateMain()
  {
   if(!$("#pnlCustomer").hasClass("hidden"))
   {
    $("#pnlCustomer").addClass("hidden");
   }
   if(!$("#pnlAccount").hasClass("hidden"))
   {
    $("#pnlAccount").addClass("hidden");
   }
   if(!$("#pnlBranch").hasClass("hidden"))
   {
    $("#pnlBranch").addClass("hidden");
   }
   if(!$("#pnlEmployee").hasClass("hidden"))
   {
    $("#pnlEmployee").addClass("hidden");
   }
   $("#pnlMain").removeClass("hidden");
  }
  function setReadOnly(name)
  {
   $(name).attr("readonly", true);
   $(name).addClass("rdonly");
   $(name).attr("tabindex", -1);
  }
  $(document).ready(function()
  {
   try
   {
    var customerModel = new kendo.data.Model.define({
     id: "CustomerID",
     fields: {
      CustomerID: {},
      CustomerTicket: {},
      Name: {},
      Address: {},
      City: {},
      State: {},
      ZipCode: {},
      TIN: {}
     }
    });

    var customerData = new kendo.data.DataSource({
     schema: customerModel,
     transport: {
      read: {
       url: "api/Customers/",
       dataType: "json"
      },
      update: {
       // Notice that an update won't occur on this DataSource if a model with
       // an id: hasn't been defined. In this case, id: "CustomerID" is defined
       // in the model.
       url: "api/Customers/",
       dataType: "json",
       type: "POST"
      },
      destroy: {
       url: "api/Customers/",
       dataType: "json",
       type: "DELETE"
      },
      parameterMap: function(options, operation)
      {
       //if(operation === "update")
       //{
       // // During an update, any dates need to be formatted in a way they can
       // // be consumed by WebAPI.
       // var d = new Date(options.DateOpened);
       // options.DateOpened = kendo.toString(d, "MM/dd/yyyy");
       //}
       return options;
      }
     },
     pageSize: 20
    });

    var customerViewModel = kendo.observable({
     packageSource: customerData,
     selectedItem: null,
     isSaveVisible: true,
     isSaveEnabled: false,
     textChanged: function(e)
     {
      this.set("isSaveEnabled", true);
      console.log("Text changed Event: " + e.type);
     },
     saveClicked: function(e)
     {
      console.log("Has changes: " + this.packageSource.hasChanges());
      console.log("Save clicked Event.");
      this.packageSource.sync();
      this.set("isSaveEnabled", false);
     }
    });

    $("#tabstrip").kendoTabStrip({
     animation: {
      open: {
       effects: "fadeIn"
      }
     }
    });

    $("#dgCustomers").kendoGrid({
     dataSource: customerData,
     height: 550,
     groupable: true,
     sortable: true,
     selectable: "row",
     pageable: {
      refresh: true,
      pageSizes: true,
      buttonCount: 5
     },
     columns: [{
      template: '<div class="record-icon"' +
      'style="background-image: url(Images/Customer.png);"></div>' +
      '<div class="record-name">#: Name #</div>',
      field: "Name",
      title: "Name",
      alttemplate: '<a href="Customer.html?id=#=CustomerID#" ' +
       ' target="blank">#=Name#</a>',
      width: 240
     }, {
      field: "Address",
      title: "Address"
     }, {
      field: "City",
      title: "City"
     }, {
      field: "ZipCode",
      title: "Zip Code",
      width: 150
     }],
     change: function(e)
     {
      var selectedRow = this.select();
      if(selectedRow)
      {
       var dataItem = this.dataItem(selectedRow);
       if(dataItem)
       {
        this.set("selectedItem", dataItem);
        console.log("Switching view from Main to Customer...");
        $("#pnlMain").addClass("hidden");
        $("#pnlCustomer").removeClass("hidden");
       }
      }
     }
    });
    kendo.bind($("#dgCustomers"), customerViewModel);
    kendo.bind($("#frmCustomer"), customerViewModel);
    setReadOnly("#customerTicket");
    customerData.read();
    // /ready.
   }
   catch(ex)
   {
    alert("Error: " + ex.message);
   }
  });
 </script>

</body>
</html>
